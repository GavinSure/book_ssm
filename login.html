<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>登录页面</title>

		<!-- Google Font: Source Sans Pro -->
		<link rel="stylesheet"
			href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
		<!-- icheck bootstrap -->
		<link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
		<!-- SweetAlert2 -->
		<link rel="stylesheet" href="plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
		<!-- Toastr -->
		<link rel="stylesheet" href="plugins/toastr/toastr.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="css/adminlte.min.css">

	</head>
	<body class="hold-transition login-page">
		<div class="login-box">
			<div class="login-logo">
				<a href="#"><b>Welcome</b>login</a>
			</div>
			<!-- /.login-logo -->
			<div class="card">
				<div class="card-body login-card-body">
					<form>
						<div class="input-group mb-3">
							<input type="email" id="email" class="form-control" placeholder="Email">
							<div class="input-group-append">
								<div class="input-group-text">
									<span class="fas fa-envelope"></span>
								</div>
							</div>
						</div </form>

						<div class="social-auth-links text-center mb-3">
							<a href="javascript:void(0)" class="btn btn-block btn-primary" id="loginBtn">
								登录
							</a>
							<a href="javascript:void(0)" class="btn btn-block btn-danger" id="activeBtn"
								style="display: none">
								激活
							</a>
						</div>
				</div>
			</div>
		</div>
		<!-- jQuery -->
		<script src="./plugins/jquery/jquery.min.js"></script>
		<!-- Bootstrap 4 -->
		<script src="./plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="./plugins/sweetalert2/sweetalert2.min.js"></script>
		<script src="./plugins/toastr/toastr.min.js"></script>
		<!-- AdminLTE App -->
		<script src="./js/adminlte.min.js"></script>
		<script type="application/javascript">

			let params = new URLSearchParams(location.search);
			let error=params.get("error");
			if (params.get("error")=="timeOut")
				toastr.error("邮箱验证码已过期,请重新登录");
			if (error=="noLogin")
				toastr.error("您还未登录，请您先登录");
			$("#loginBtn").click(() => {
				let email = $("#email").val();
				$.get("http://127.0.0.1:8080/admin/adminLogin", {
					"email": email
				}, response => {
					console.log(response)
					let {
						status,
						msg,
						data
					} = response;
					if (status == "2001") {
						toastr.error("该邮箱尚未注册此系统，请先联系管理员");
					}
					if (status == "2002") {
						toastr.error("该邮箱尚未激活，请先激活");
						$("#activeBtn").show();
					}
					if (status == "1001") {
						//已经被激活 跳转到验证码页面 并提示用户  "验证码已经发送到了邮箱 请去查收"
						window.location.replace("code.html?email="+email+"&image="+data);

					}

				});
			});

			$("#activeBtn").click(()=>{
				//异步请求服务器
				$.get(`http://127.0.0.1:8080/admin/sendActiveEmail`,{"email":$("#email").val()},response=>{
					let {
							status,
							msg,
							data
					}=response;

					if (status=="2003"){
						toastr.error("邮箱已经被激活，请直接登录");
					}else {
						toastr.success("激活链接已成功发送邮箱，请前去激活！");
					}

				});
			});

			//    $("#loginBtn").click(()=>{
			// 	 toastr.error("该邮箱尚未注册，请先激活");
			// 	 $("#activeBtn").slideDown(1000);
			// });

			// $("#loginBtn").click(()=>{
			// 	 // window.location.replace("/code.html?email=" + email+"&avatar="+data.data);
			// 	  window.location.replace("code.html");
			// });


			// $("#activeBtn").click(()=>{
			// 	toastr.success("激活链接已成功发送邮箱，请前去激活！");
			// });
		</script>
	</body>
</html>
